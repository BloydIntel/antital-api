services:

  db:
    image: postgres:15
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: antitaldb
    ports:
      - "55432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

  antital.api:
    image: ${DOCKER_REGISTRY-}antitalapi
    build:
      context: .
      dockerfile: Antital.API/Dockerfile
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_HTTP_PORTS: 8001
      ConnectionStrings__DefaultConnection: Host=db;Port=5432;Database=antitaldb;Username=postgres;Password=postgres;
    depends_on:
      - db
    ports:
      - "18001:8001"

  # ============================================
  # WORKER SERVICES - COMMENTED FOR MINIMAL SETUP
  # ============================================
  # antitalworkerdb:
  #   image: postgres

  # antital.worker.api1:
  #   image: ${DOCKER_REGISTRY-}antitalworkerapi
  #   build:
  #     context: .
  #     dockerfile: Antital.Worker.API/Dockerfile

  # antital.worker.api2:
  #   image: ${DOCKER_REGISTRY-}antitalworkerapi
  #   build:
  #     context: .
  #     dockerfile: Antital.Worker.API/Dockerfile

  # antital.worker.api3:
  #   image: ${DOCKER_REGISTRY-}antitalworkerapi
  #   build:
  #     context: .
  #     dockerfile: Antital.Worker.API/Dockerfile

  # antital.worker.loadbalancer:
  #   image: ${DOCKER_REGISTRY-}antitalworkerloadbalancer
  #   build:
  #     context: .
  #     dockerfile: Antital.Worker.LoadBalancer/Dockerfile

  # ============================================
  # MONITORING - COMMENTED FOR MINIMAL SETUP
  # ============================================
  # prometheus:
  #   image: prom/prometheus

  # grafana:
  #   image: grafana/grafana

  # ============================================
  # CACHING & MESSAGING - COMMENTED FOR MINIMAL SETUP
  # ============================================
  # redis:
  #   image: redis/redis-stack

  # rabbitmq:
  #   image: rabbitmq:management

  # ============================================
  # SEARCH & LOGGING - COMMENTED FOR MINIMAL SETUP
  # ============================================
  # elasticsearch:
  #   image: docker.elastic.co/elasticsearch/elasticsearch:8.14.3

  # kibana:
  #   image: docker.elastic.co/kibana/kibana:8.14.3

  # ============================================
  # DATABASE MANAGEMENT - COMMENTED FOR MINIMAL SETUP
  # ============================================
  # pgadmin:
  #   image: dpage/pgadmin4

  # ============================================
  # DOCKER MANAGEMENT - COMMENTED FOR MINIMAL SETUP
  # ============================================
  # portainer:
  #   image: portainer/portainer-ce

volumes:
  pgdata:
